# 全局提示词编辑器使用指南

## 📝 什么是全局提示词编辑器？

全局提示词编辑器（Global Traits Editor）是一个**自定义AI行为**的工具，让您可以根据个人需求调整AI的答案风格、详细程度和特殊要求。

**快捷键**：`Ctrl + X`

---

## 🎯 核心作用

### 1. **个性化答案风格**
定制符合您需求的答案格式和表达方式

### 2. **控制详细程度**
决定解答的详细程度（简洁/详细/超详细）

### 3. **特殊要求设定**
添加老师的特殊要求或答题规范

### 4. **一次设置永久生效**
设置后对所有题目生效，无需重复输入

---

## ⚙️ Prompt设定机制

### 工作原理

```
最终发送给AI的Prompt = 基础系统Prompt + 全局Traits + AI源Traits
```

### 详细流程

```typescript
// 1. 基础系统Prompt（内置200+行优化）
SOLVE_SYSTEM_PROMPT = `
  #### 角色
  你是一个高级AI作业求解器...
  
  #### 工作流程（8步）
  1. 分析图片
  2. 提取问题
  3. 识别题型
  4. 分析题意
  5. 制定策略
  6. 分步求解
  7. 验证答案
  8. 格式化输出
  
  #### 质量要求
  - 准确性第一
  - 步骤完整
  - 验证必做
  - 单位规范
  - 公式准确
  ...
`

// 2. AI源专属Traits（可选，在设置中为每个AI源单独配置）
source.traits = "使用更学术的语言"

// 3. 全局Traits（您在编辑器中输入的内容）
traits = "答案要详细，步骤要完整"

// 4. 组合成最终Prompt
finalPrompt = SOLVE_SYSTEM_PROMPT 
            + "\nUser defined prompts:\n<prompt>\n" + source.traits + "\n</prompt>\n"
            + "\nUser defined traits:\n<traits>\n" + traits + "\n</traits>\n"
```

### 实际代码实现

```typescript
// src/components/pages/ScanPage.tsx (行 320-357)

const promptPrompt = source.traits
  ? `\nUser defined prompts:
<prompt>
${source.traits}
</prompt>
`
  : "";

const traitsPrompt = traits
  ? `\nUser defined traits:
<traits>
${traits}
</traits>
`
  : "";

ai.setSystemPrompt(
  SOLVE_SYSTEM_PROMPT + promptPrompt + traitsPrompt
);
```

---

## 💡 使用示例

### 示例1：要求详细解答

**输入**：
```
答案必须包含详细的推导过程
每一步都要说明依据
计算题必须验证答案
选择题必须分析所有选项
```

**效果**：AI会给出超详细的解答，每步都标注依据

---

### 示例2：符合老师要求

**输入**：
```
物理题必须画受力分析图（用文字描述）
计算过程要列竖式
最后用【答案】标注最终答案
使用标准答题格式
```

**效果**：答案格式符合老师批改习惯

---

### 示例3：简洁模式

**输入**：
```
只输出最终答案即可
选择题不需要解析
填空题直接给答案
```

**效果**：快速获得答案，不浪费token

---

### 示例4：学习模式

**输入**：
```
使用苏格拉底式提问法
先给出思路提示
让我先思考
然后再给出完整答案
```

**效果**：培养思维能力，不是直接给答案

---

### 示例5：考试风格

**输入**：
```
使用高考标准答题格式
严谨的学术语言
避免口语化表达
数学符号要规范
物理量必须带单位
```

**效果**：规范的考试答案风格

---

## 🎨 高级技巧

### 1. **分学科定制**

```
数学题：
- 必须使用规范的LaTeX公式
- 每步推导要注明依据（公式名称）
- 最后验证答案

物理题：
- 必须分析受力情况
- 单位换算要详细
- 列出已知量和求解量
- 使用国际单位制

化学题：
- 化学方程式要配平
- 注明反应条件
- 计算摩尔质量
```

### 2. **格式控制**

```
格式要求：
- 使用Markdown语法
- 重要步骤加粗显示
- 使用编号列表（1. 2. 3.）
- 最终答案用方框标注
- 公式单独成行
```

### 3. **难度调节**

```
初中难度：
- 使用简单易懂的语言
- 步骤要细分
- 多举例说明
- 避免高深术语

高中难度：
- 使用标准术语
- 步骤可以适当简化
- 强调关键公式

大学难度：
- 使用专业术语
- 简洁但完整
- 注重原理
```

---

## 📊 优先级关系

当不同Prompt有冲突时的优先级：

```
全局Traits（最高优先级）
    ↓
AI源Traits
    ↓
基础系统Prompt（最低优先级）
```

**原因**：您的个人需求应该覆盖默认设置

---

## 🔍 与单题改进的区别

| 特性 | 全局Traits | 单题改进（/键） |
|------|-----------|---------------|
| 作用范围 | 所有题目 | 当前题目 |
| 持久性 | 永久保存 | 一次性 |
| 快捷键 | Ctrl+X | / |
| 使用场景 | 通用规则 | 特殊要求 |
| 示例 | "答案要详细" | "这道题请用图解法" |

---

## 💾 数据存储

**存储位置**：浏览器 localStorage  
**键名**：`settings-storage`  
**持久性**：除非清除浏览器数据，否则永久保存

```typescript
// src/store/settings-store.ts
export const useSettingsStore = create<SettingsStore>()(
  persist(
    (set) => ({
      traits: "",  // 默认为空
      setTraits: (traits) => set({ traits }),
      ...
    }),
    {
      name: "settings-storage",
      storage: createJSONStorage(() => localStorage),
    }
  )
);
```

---

## ⚠️ 注意事项

### 1. **不要过度约束**
❌ 太多规则会让AI困惑
```
必须这样...不能那样...一定要...绝对不...（50条规则）
```

✅ 简洁明确的核心要求
```
1. 步骤详细
2. 包含验证
3. 使用标准格式
```

### 2. **避免矛盾指令**
❌ 相互矛盾
```
要详细解释
同时要简洁明了
```

✅ 明确优先级
```
以简洁为主，但关键步骤要详细解释
```

### 3. **测试效果**
设置后先用1-2道题测试效果，满意后再批量处理

---

## 🎯 最佳实践

### 推荐的通用配置

```
答案要求：
1. 步骤完整，逻辑清晰
2. 每步标明依据（公式、定理、已知条件）
3. 计算题必须代入验证
4. 选择题说明为什么其他选项错误
5. 使用规范的LaTeX格式
6. 物理量必须带单位
7. 最终答案用【答案】标注

格式要求：
- 使用Markdown语法
- 重要步骤加粗
- 公式单独成行
```

---

## 🔧 故障排除

### 问题1：设置后没有效果
**原因**：可能被缓存影响  
**解决**：刷新页面重新提交题目

### 问题2：AI输出变得很怪
**原因**：Traits写得太复杂或有矛盾  
**解决**：清空Traits（设为空），重新简化设置

### 问题3：想恢复默认
**操作**：打开编辑器，清空所有内容，点击提交

---

## 📚 参考资源

- **基础系统Prompt**：`src/ai/prompts.ts` (SOLVE_SYSTEM_PROMPT)
- **组合逻辑**：`src/components/pages/ScanPage.tsx` (行 340-357)
- **UI组件**：`src/components/GlobalTraitsEditor.tsx`
- **状态管理**：`src/store/settings-store.ts`

---

## 🎉 小结

全局提示词编辑器是一个**强大的个性化工具**：

✅ 让AI完全按照您的要求工作  
✅ 一次设置，永久生效  
✅ 支持复杂的答题规范  
✅ 适应不同学科和场景  
✅ 提升答案质量和规范性  

**立即体验**：按 `Ctrl+X` 开始定制您的专属AI助手！
